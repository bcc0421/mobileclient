<!--
  Generated template for the ChatPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
    <ion-navbar>
        <ion-title>工作消息</ion-title>
        <ion-buttons right>
            <button ion-button full (click)="ReleaseMsg()">
                <ion-icon name="ios-megaphone"></ion-icon>
            </button>
        </ion-buttons>
    </ion-navbar>
    <ion-toolbar no-border-top>
        <ion-segment [(ngModel)]="pet">
            <ion-segment-button value="chatlog">
                最近
            </ion-segment-button>
            <ion-segment-button value="chatlist">
                组织架构
            </ion-segment-button>
            <ion-segment-button value="chatqun">
                讨论组
            </ion-segment-button>
        </ion-segment>
    </ion-toolbar>
</ion-header>
<ion-content>
    <div>
        <div [hidden]="pet=='chatlist'">
            <div class="nologmessage" *ngIf="chatlog_persons.length==0">
                <ion-icon name="xiaoxi"></ion-icon> {{logmsg}}</div>
            <ion-list no-lines>
                <ng-container *ngFor="let user of chatlog_persons">
                    <ion-item-sliding no-lines [navPush]="ChatUserPage" [navParams]="user">
                        <ion-item>
                            <ion-avatar item-start>
                                <img src="{{chatser.native.appServer.node}}person/personPic?pid={{user._id}}">
                            </ion-avatar>
                            <h2>{{user.name}}</h2>
                            <p>{{ user.message || '暂时没有聊天记录' }}</p>
                            <b class="imread" *ngIf="user.count>0"></b>
                        </ion-item>
                    </ion-item-sliding>
                </ng-container>
            </ion-list>
        </div>
        <div [hidden]="pet=='chatlog'">
            <ion-searchbar placeholder="搜索" [(ngModel)]="searchKey"></ion-searchbar>
            <ion-list *ngFor="let item of chatser.deptlist" no-lines>
                <ion-list-header *ngIf="!searchKey">
                    {{item.name}}
                </ion-list-header>
                <ng-container *ngFor="let user of item.persons">
                    <ion-item-sliding *ngIf="showChat(user.person.name) && user.person._id!=chatser.native.UserSession._id" no-lines [navPush]="ChatUserPage"
                        [navParams]="user.person">
                        <ion-item>
                            <ion-avatar item-start>
                                <img src="{{chatser.native.appServer.node}}person/personPic?pid={{user.person._id}}">
                            </ion-avatar>
                            <h2>{{user.person.name}}</h2>
                            <p>{{ user.msg && user.msg.text || '暂时没有聊天记录' }}</p>
                            <b class="imread" *ngIf="user.msg && user.msg.count>0"></b>
                        </ion-item>
                        <ion-item-options>
                            <button (click)="go(0,user.person.mobile)" ion-button color="primary" icon-start>
                                <ion-icon name="text"></ion-icon>
                                短信
                            </button>
                            <button (click)="go(1,user.person.mobile)" ion-button color="secondary" icon-start>
                                <ion-icon name="call"></ion-icon>
                                电话
                            </button>
                        </ion-item-options>
                    </ion-item-sliding>
                </ng-container>
            </ion-list>
        </div>
        <div *ngSwitchCase="'chatqun'">
            <div class="nologmessage">
                <ion-icon name="xiaoxi"></ion-icon> 您没有讨论组</div>
        </div>
    </div>
</ion-content>